Installation and setup notes

utf8mb4 support:
----------------

As of Drupal 7.50 ut8mb4 support is in core: 

https://www.drupal.org/node/2754539

These notes are only required if you are upgrading from non-utf8mb4 database.

Notes:
https://www.drupal.org/project/utf8mb4_convert (upgrade tool)

Steps:

1. Update /etc/mysql/my.cnf:
	- innodb_file_per_table
    - innodb_large_prefix
    - innodb_file_format=barracuda 
2. In settings.php in database:
    - 'charset' => 'utf8mb4',
    - 'collation' => 'utf8mb4_general_ci',

3. Run drush @none dl utf8mb4_convert

4. run drush utf8mb4-convert-databases

5. Manually update tables

# tm_status_update

alter table tm_newsfeed_preview_links CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
alter table tm_newsfeed_status_updates CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
alter table tm_newsfeed_view_count_daily CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
alter table tm_newsfeed_view_count_total CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

5. Check tables:

show table status from DATABASE_NAME

(note: search_db remains as utf8_unicode_ci)

6. Hide warnings (optional)

If not all tables are converted you will receive this warning in admin panel

"Please convert all databases to utf8mb4 prior to enabling it in settings.php"

To turn it off, run:

drush vset drupal_all_databases_are_utf8mb4 1


How to edit SASS stylesheets with Compass
-----------------------------------------

To edit SASS stylesheets you'll need compass installed:

https://www.drupal.org/node/2353067#comment-9535245
sudo gem install sass -v 3.2.19
sudo gem install compass -v 0.12.6

Run "compass watch sites/all/themes/tm" to update css files


How to manually flag someone to attend an event:
------------------------------------------------

Change the userid and event id accordingly.

# example for regular event
# drush php-eval '$account = user_load(34757); $content_id = 16555; $event_register = flag_get_flag("event_register"); $event_register->flag('flag', $content_id, $account, null);'

# example for paid event
# drush php-eval '$account = user_load(34757); $content_id = 16555; $event_paid = flag_get_flag("event_paid"); $event_paid->flag('flag', $content_id, $account, null); $event_register = flag_get_flag("event_register"); $event_register->flag('flag', $content_id, $account, null);'


How to manually add a subscription payment for a company:
------------------------------------------------

Change the user id and nodeid accordingly.

# flag company subscription payment
# drush php-eval '$account = user_load(14840); $content_id = 17443; $subscription_paid = flag_get_flag("organization_subscription_paid"); $subscription_paid->flag("flag", $content_id, $account, true);'

How to export member questions to csv:
------------------------------------------------

# Replace 1 with 1,2,3 or 4 for question index

SELECT field_user_question_1_value, field_user_country_iso2, concat("https://example.massiveplatform.com/user/", field_revision_field_user_country.entity_id)
FROM field_data_field_user_question_1
LEFT JOIN field_revision_field_user_country 
ON field_revision_field_user_country.entity_id = field_data_field_user_question_1.entity_id
INTO OUTFILE '/tmp/user_questions_1.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n';

How to increase performance of flagging table with many rows
------------------------------------------------

# improve flag_get_user_flags performance with large tables
show index from flagging;
ALTER TABLE `flagging` ADD INDEX `tm_uid` (`uid`);

How to increase performance of tm_track_views lookups
------------------------------------------------
ALTER TABLE `tm_track_views` ADD INDEX `tm_entity_type` (`entity_type`);
ALTER TABLE `tm_track_views` ADD INDEX `tm_entity_id` (`entity_id`);


